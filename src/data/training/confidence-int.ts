import type { TrainingQuestion } from './types';

const questions: TrainingQuestion[] = [
  // Level 1
  {
    id: 'confidence-int-l1-1',
    nodeId: 'confidence-int',
    level: 1,
    title: 'Interpreting a Confidence Interval',
    text: 'A 95% confidence interval for a population proportion is $(0.42, 0.58)$. Which interpretation is correct?',
    hints: ['A confidence interval is about the procedure, not a single interval'],
    answer: 'We are 95% confident that the true population proportion lies between 0.42 and 0.58.',
    marks: 1,
    isMultipleChoice: true,
    options: [
      { label: 'A', text: 'There is a 95% probability that the true proportion is between 0.42 and 0.58', correct: false },
      { label: 'B', text: '95% of the data falls between 0.42 and 0.58', correct: false },
      { label: 'C', text: 'If we repeated the sampling many times, about 95% of the resulting intervals would contain the true proportion', correct: true },
      { label: 'D', text: 'The sample proportion is 95% accurate', correct: false },
    ],
  },
  {
    id: 'confidence-int-l1-2',
    nodeId: 'confidence-int',
    level: 1,
    title: 'Margin of Error',
    text: 'A survey of 400 people finds that 55% support a policy. Find the margin of error for a 95% confidence interval.',
    hints: ['Margin of error $= z^* \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}$ with $z^* = 1.96$'],
    answer: '$ME = 1.96\\sqrt{\\frac{0.55 \\times 0.45}{400}} = 1.96 \\times 0.02487 = 0.0487 \\approx 0.049$',
    marks: 2,
  },
  {
    id: 'confidence-int-l1-3',
    nodeId: 'confidence-int',
    level: 1,
    title: 'Constructing a 95% CI',
    text: 'In a sample of 200 students, 120 prefer online learning. Construct a 95% confidence interval for the true proportion.',
    hints: ['$\\hat{p} = \\frac{120}{200} = 0.6$. Use $\\hat{p} \\pm 1.96\\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}$'],
    answer: '$\\hat{p} = 0.6$. $ME = 1.96\\sqrt{\\frac{0.6 \\times 0.4}{200}} = 1.96 \\times 0.03464 = 0.0679$. CI: $(0.532, 0.668)$.',
    marks: 2,
  },
  {
    id: 'confidence-int-l1-4',
    nodeId: 'confidence-int',
    level: 1,
    title: 'Effect of Sample Size',
    text: 'If the sample size is quadrupled (from $n$ to $4n$), what happens to the width of the confidence interval?',
    hints: ['The width is proportional to $\\frac{1}{\\sqrt{n}}$'],
    answer: 'The width is halved, because $\\frac{1}{\\sqrt{4n}} = \\frac{1}{2\\sqrt{n}}$.',
    marks: 2,
    isMultipleChoice: true,
    options: [
      { label: 'A', text: 'Halved', correct: true },
      { label: 'B', text: 'Quartered', correct: false },
      { label: 'C', text: 'Doubled', correct: false },
      { label: 'D', text: 'Unchanged', correct: false },
    ],
  },
  // Level 2
  {
    id: 'confidence-int-l2-1',
    nodeId: 'confidence-int',
    level: 2,
    title: '99% Confidence Interval',
    text: 'A poll of 500 voters finds 280 support a candidate. Construct a 99% confidence interval for the true proportion of supporters.',
    hints: ['For 99% CI, $z^* = 2.576$. $\\hat{p} = 0.56$.'],
    answer: '$\\hat{p} = 0.56$. $ME = 2.576\\sqrt{\\frac{0.56 \\times 0.44}{500}} = 2.576 \\times 0.02220 = 0.0572$. CI: $(0.503, 0.617)$.',
    marks: 3,
  },
  {
    id: 'confidence-int-l2-2',
    nodeId: 'confidence-int',
    level: 2,
    title: 'Required Sample Size',
    text: 'A researcher wants to estimate a proportion within $\\pm 0.03$ with 95% confidence. What is the minimum sample size needed (using $\\hat{p} = 0.5$ for the worst case)?',
    hints: ['$n = \\left(\\frac{z^*}{ME}\\right)^2 \\hat{p}(1-\\hat{p})$'],
    answer: '$n = \\left(\\frac{1.96}{0.03}\\right)^2 \\times 0.25 = (65.33)^2 \\times 0.25 = 4268.4 \\times 0.25 = 1067.1$. Round up: $n = 1068$.',
    marks: 3,
  },
  {
    id: 'confidence-int-l2-3',
    nodeId: 'confidence-int',
    level: 2,
    title: 'Checking Conditions',
    text: 'A sample of 30 people is taken and 2 support a proposal ($\\hat{p} = 0.067$). Can we construct a valid normal-based confidence interval? Explain.',
    hints: ['Check if $n\\hat{p} \\geq 10$ and $n(1-\\hat{p}) \\geq 10$'],
    answer: '$n\\hat{p} = 30 \\times 0.067 = 2 < 10$. The success condition is not met, so the normal approximation is not valid. A larger sample or an exact method (e.g., Clopper-Pearson) is needed.',
    marks: 3,
  },
  {
    id: 'confidence-int-l2-4',
    nodeId: 'confidence-int',
    level: 2,
    title: 'Comparing Confidence Levels',
    text: 'For the same sample data, which is wider: a 90% CI or a 99% CI? Explain why.',
    hints: ['Compare the critical values $z^*$ for each level'],
    answer: 'The 99% CI is wider. A higher confidence level uses a larger $z^*$ ($2.576$ vs $1.645$), producing a wider interval to be more certain of capturing the true parameter.',
    marks: 3,
  },
  // Level 3
  {
    id: 'confidence-int-l3-1',
    nodeId: 'confidence-int',
    level: 3,
    title: 'CI and Hypothesis Testing Link',
    text: 'A 95% confidence interval for a population proportion is $(0.52, 0.68)$. At the 5% significance level, would you reject $H_0: p = 0.5$? What about $H_0: p = 0.6$?',
    hints: ['If the hypothesised value lies outside the CI, reject $H_0$'],
    answer: 'Reject $H_0: p = 0.5$ because 0.5 is not in the interval $(0.52, 0.68)$. Do not reject $H_0: p = 0.6$ because 0.6 is inside the interval.',
    marks: 4,
  },
  {
    id: 'confidence-int-l3-2',
    nodeId: 'confidence-int',
    level: 3,
    title: 'Sample Size with Prior Estimate',
    text: 'Previous research suggests $p \\approx 0.3$. How many people should be sampled for a 95% CI with margin of error no more than 0.04?',
    hints: ['$n = \\left(\\frac{1.96}{0.04}\\right)^2 \\times 0.3 \\times 0.7$'],
    answer: '$n = (49)^2 \\times 0.21 = 2401 \\times 0.21 = 504.21$. Round up: $n = 505$.',
    marks: 4,
  },
  {
    id: 'confidence-int-l3-3',
    nodeId: 'confidence-int',
    level: 3,
    title: 'Interpreting Overlapping CIs',
    text: 'Group A: $\\hat{p}_A = 0.45$, 95% CI $(0.38, 0.52)$, $n_A = 200$. Group B: $\\hat{p}_B = 0.52$, 95% CI $(0.44, 0.60)$, $n_B = 150$. The CIs overlap. Does this mean there is no significant difference between the groups?',
    hints: [
      'Overlapping CIs do not necessarily mean no significant difference',
      'A proper test would compare the difference $\\hat{p}_A - \\hat{p}_B$ directly',
    ],
    answer: 'No. Overlapping individual CIs does not guarantee no significant difference. We should construct a CI for the difference $p_A - p_B$: $\\hat{p}_A - \\hat{p}_B = -0.07$, $SE = \\sqrt{\\frac{0.45 \\times 0.55}{200} + \\frac{0.52 \\times 0.48}{150}} = \\sqrt{0.001238 + 0.001664} = 0.0539$. 95% CI: $(-0.07 \\pm 0.106) = (-0.176, 0.036)$. Since 0 is in this interval, the difference is not significant at 5%.',
    marks: 4,
  },
  // Level 4
  {
    id: 'confidence-int-l4-1',
    nodeId: 'confidence-int',
    level: 4,
    title: 'Wilson Score Interval',
    text: 'For $n = 20$ and $\\hat{p} = 0.1$ (2 successes), calculate the Wilson score 95% confidence interval: $\\tilde{p} = \\frac{\\hat{p} + \\frac{z^2}{2n}}{1 + \\frac{z^2}{n}}$ and $\\tilde{p} \\pm \\frac{z}{1+\\frac{z^2}{n}}\\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n} + \\frac{z^2}{4n^2}}$.',
    hints: [
      'Use $z = 1.96$, so $z^2 = 3.8416$',
      'Compute each part step by step',
    ],
    answer: '$\\tilde{p} = \\frac{0.1 + \\frac{3.8416}{40}}{1 + \\frac{3.8416}{20}} = \\frac{0.1 + 0.0960}{1.1921} = \\frac{0.1960}{1.1921} = 0.1644$. $\\text{Width} = \\frac{1.96}{1.1921}\\sqrt{\\frac{0.09}{20} + \\frac{3.8416}{1600}} = 1.6442\\sqrt{0.0045 + 0.0024} = 1.6442 \\times 0.0831 = 0.1366$. CI: $(0.028, 0.301)$.',
    marks: 5,
  },
  {
    id: 'confidence-int-l4-2',
    nodeId: 'confidence-int',
    level: 4,
    title: 'Effect of Finite Population',
    text: 'A school has 500 students. A random sample of 80 finds 60% support a new policy. Construct a 95% CI using the finite population correction factor.',
    hints: [
      'FPC: $\\sqrt{\\frac{N-n}{N-1}}$. Multiply the standard error by this factor.',
    ],
    answer: '$SE = \\sqrt{\\frac{0.6 \\times 0.4}{80}} = 0.05477$. FPC $= \\sqrt{\\frac{500-80}{499}} = \\sqrt{\\frac{420}{499}} = 0.9174$. Adjusted SE $= 0.05477 \\times 0.9174 = 0.05025$. CI: $0.6 \\pm 1.96 \\times 0.05025 = (0.502, 0.698)$.',
    marks: 5,
  },
  {
    id: 'confidence-int-l4-3',
    nodeId: 'confidence-int',
    level: 4,
    title: 'Coverage Probability Simulation',
    text: 'Explain why the actual coverage probability of the Wald interval $\\hat{p} \\pm z\\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}$ can be substantially less than the nominal 95% for small $n$ or extreme $p$. Give a specific example.',
    hints: [
      'Consider $n=20$, $p=0.05$. What happens when $\\hat{p}=0$?',
    ],
    answer: 'When $n=20$, $p=0.05$: $\\Pr(\\hat{p}=0) = 0.95^{20} \\approx 0.358$. When $\\hat{p}=0$, the Wald interval is $(0,0)$ which cannot contain $p=0.05$. So at least 35.8% of intervals miss, giving coverage at most 64.2%, far below 95%. This occurs because the normal approximation to the binomial is poor when $np$ is small, and $\\hat{p}$ in the SE formula underestimates variability near boundaries.',
    marks: 5,
  },
  // Level 5
  {
    id: 'confidence-int-l5-1',
    nodeId: 'confidence-int',
    level: 5,
    title: 'Deriving the Agresti-Coull Interval',
    text: 'The Agresti-Coull interval uses $\\tilde{n} = n + z^2$ and $\\tilde{p} = \\frac{X + z^2/2}{\\tilde{n}}$. Show that this is equivalent to inverting the score test $\\frac{(\\hat{p}-p_0)^2}{p_0(1-p_0)/n} \\leq z^2$ and solving for $p_0$.',
    hints: [
      'Expand the score test inequality: $(\\hat{p}-p_0)^2 \\leq z^2 p_0(1-p_0)/n$',
      'Rearrange as a quadratic in $p_0$',
    ],
    answer: 'From $(\\hat{p}-p_0)^2 \\leq \\frac{z^2 p_0(1-p_0)}{n}$: $n(\\hat{p}-p_0)^2 \\leq z^2 p_0 - z^2 p_0^2$. $np_0^2 - 2n\\hat{p}p_0 + n\\hat{p}^2 \\leq z^2 p_0 - z^2 p_0^2$. $(n+z^2)p_0^2 - (2n\\hat{p}+z^2)p_0 + n\\hat{p}^2 \\leq 0$. Dividing by $(n+z^2)$: $p_0^2 - 2\\tilde{p}\\,p_0 + \\frac{n\\hat{p}^2}{n+z^2} \\leq 0$ where $\\tilde{p} = \\frac{n\\hat{p}+z^2/2}{n+z^2}$. The roots give the Wilson interval; the Agresti-Coull approximation replaces the exact Wilson bounds with $\\tilde{p} \\pm z\\sqrt{\\frac{\\tilde{p}(1-\\tilde{p})}{\\tilde{n}}}$.',
    marks: 6,
  },
  {
    id: 'confidence-int-l5-2',
    nodeId: 'confidence-int',
    level: 5,
    title: 'Bayesian Credible Interval',
    text: 'With a $\\text{Beta}(1,1)$ (uniform) prior on $p$ and observing $k = 8$ successes in $n = 20$ trials, find a 95% Bayesian credible interval for $p$ using the posterior distribution. Compare with the frequentist Wald interval.',
    hints: [
      'Posterior is $\\text{Beta}(k+1, n-k+1) = \\text{Beta}(9, 13)$',
      'For Beta(9,13), mean $= 9/22 \\approx 0.409$',
    ],
    answer: 'Posterior: $\\text{Beta}(9, 13)$. Mean $= 9/22 = 0.409$. Mode $= 8/20 = 0.4$. Using Beta quantiles: $\\text{Beta}_{0.025}(9,13) \\approx 0.224$ and $\\text{Beta}_{0.975}(9,13) \\approx 0.609$. Bayesian 95% credible interval: $(0.224, 0.609)$. Frequentist Wald: $\\hat{p} = 0.4$, $SE = \\sqrt{\\frac{0.4 \\times 0.6}{20}} = 0.1095$, CI $= (0.185, 0.615)$. The Bayesian interval is slightly narrower and shifted towards 0.5 due to the prior.',
    marks: 6,
  },
];

export default questions;
